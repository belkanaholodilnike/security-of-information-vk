<!DOCTYPE html>
<html>
<head lang="ru">
    <meta charset="UTF-8">
    <title>Test page</title>
    <script type="text/javascript" src="sha3.js"></script>
    <script type="text/javascript" src="aes.js"></script>
    <script type="text/javascript" src="decimal.js"></script>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript" src="elgamal.js"></script>
    <script type="text/javascript" src="aes.js"></script>
    <script type="text/javascript" src="sha3.js"></script>
    <script type="text/javascript" src="random.js"></script>
    <script type="text/javascript" src="elgamal.js"></script>
    <script type="text/javascript" src="libVkInject.js"></script>
    <script type="text/javascript" src="secureInjection.js"></script>
    <script type="text/javascript" src="frame.js"></script>

</head>
<body>
<script language="JavaScript">
    var entityMap = {
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': '&quot;',
        "'": '&#39;',
        "/": '&#x2F;'
    };

    function escapeHtml(string) {
        return String(string).replace(/[&<>"'\/]/g, function (s) {
            return entityMap[s];
        });
    }

    function a () {
        var out = document.getElementById('out');


        var key = svkm.crypto.elgamal.generateKeyPair();
        out.innerHTML += JSON.stringify(key) + "<br/>";
        var encrypted = svkm.crypto.elgamal.encrypt("Hello", key['pubKey'], key);

        out.textContent += encrypted;
    }

    function randomTest() {
        var out = document.getElementById("out");
        out.innerHTML = "";
        out.innerHTML += "Размер буфера: " + mouseCoordBuffer.length + "<br/>";

        var counter = 0;
        var randomResult = 1;
        while (randomResult != null && counter < 1000) {
            randomResult = svkm.crypto.math.randomNum(64);
            counter++;
        }
        out.innerHTML += "Сгенерировано: " + counter;
    }

    function testEncryptDecrypt() {
        var starttime = new Date().getTime();
        svkm.crypto.KEYSIZE = 8;
        var out = document.getElementById("out");
        out.innerHTML = "";
        var message = "hello";

        var key = svkm.crypto.elgamal.generateKeyPair();
        var generatedKey = new Date().getTime();

        var encrypted = svkm.crypto.elgamal.encrypt(message, key['pubKey'], key);
        var encryptedTime = new Date().getTime();

        var decryptedReceived = svkm.crypto.elgamal.decryptReceived(encrypted, key);
        var decryptedTime = new Date().getTime();

        var decryptedSended = svkm.crypto.elgamal.decryptSended(encrypted, key);
        var decryptedTime2 = new Date().getTime();

        out.innerHTML += "Key size: " + svkm.crypto.KEYSIZE + "<br/>";
        out.innerHTML += escapeHtml("encrypted: " + encrypted);
        out.innerHTML += '<br/>';
        out.innerHTML += escapeHtml("decrypted sended: " + decryptedSended);
        out.innerHTML += '<br/>';
        out.innerHTML += escapeHtml("decrypted received: " + decryptedReceived);
        out.innerHTML += '<br/>';

        out.innerHTML += "Key generated in: " + (generatedKey - starttime) + " ms<br/>";
        out.innerHTML += "Encrypted in: " + (encryptedTime - generatedKey) + " ms</br>";
        out.innerHTML += "Decrypted received in: " + (decryptedTime - encryptedTime) + " ms<br/>";
        out.innerHTML += "Decrypted sended in: " + (decryptedTime2 - decryptedTime) + " ms<br/>";
        out.innerHTML += "All in: " + (decryptedTime2 - starttime) + " ms<br/>";

    }

    function testPowByMod() {
        var inText = document.getElementById("in");
        var nums = inText.value.split(";");

        var result = svkm.crypto.math.powByMod(new Decimal(nums[0]), new Decimal(nums[1]), new Decimal(nums[2]));

        var out = document.getElementById("out");
        out.innerHTML = "";
        out.innerHTML = result.toString();
    }

    function testGenerateKey() {
        svkm.crypto.KEYSIZE = 2048;
        var starttime = new Date().getTime();
        var out = document.getElementById("out");
        out.innerHTML = "";
        out.innerHTML += JSON.stringify(svkm.crypto.elgamal.generateKeyPair()) + "<br>";
        out.innerHTML += "Time: " + (new Date().getTime() - starttime);
    }

</script>
<label for="in"></label>
<input id="in" type="text" />
    <button id="b" onclick="a()">Click me!</button>
    <button id="encrypted-text" onclick="testEncryptDecrypt()">Test encyption</button>
    <button id="c" onclick="randomTest()">Click me random!</button>
    <button id="powByMod_Button" onclick="testPowByMod()">Test power by mod</button>
    <button id="generationKey_Button" onclick="testGenerateKey()">Test key generation</button>
<div id="out"></div>

</body>
</html>